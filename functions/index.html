<!DOCTYPE html>
<html>

<head>
  <script src="/socket.io/socket.io.js"></script>
  <script src="//www.gstatic.com/firebasejs/4.5.1/firebase.js"></script>
  <script>
    // Initialize Firebase
    // TODO: Replace with your project's customized code snippet
    var config = {
      apiKey: "AIzaSyAyfIzNW6W-fTgz2jMcijRo3URDF5BpO2M",
      authDomain: "fit3140-a5.firebaseapp.com",
      databaseURL: "//fit3140-a5.firebaseio.com",
      projectId: "fit3140-a5",
      storageBucket: "fit3140-a5.appspot.com",
      messagingSenderId: "233306876297"
    };
    // if (!firebase.apps.length) {
    //   firebase.initializeApp(config);
    // }
  </script>
  <script src="//apis.google.com/js/platform.js" async defer></script>
  <title>Gmail API Quickstart</title>
  <meta name="google-signin-client_id" content="233306876297-4j117kamdlfm7v7rstb0sgndkbt56d1l.apps.googleusercontent.com">
  <meta name="google-signin-cookiepolicy" content="single_host_origin">
  <meta name="google-signin-scope" content="profile email">
</head>

<body>
  <p>Gmail API Quickstart</p>

  <div class="g-signin2" data-onsuccess="onSignIn"></div>
  <a href="#" onclick="signOut();">Sign out</a>


  <!--Add buttons to initiate auth sequence and sign out-->
  <!-- <button id="authorize-button" style="display: none;">Authorize</button>
    <button id="signout-button" style="display: none;">Sign Out</button> -->

  <pre id="content"></pre>

  <script type="text/javascript">
      var iosocket = io.connect()

      function onSignIn(googleUser) {
        // We need to register an Observer on Firebase Auth to make sure auth is initialized.
        var unsubscribe = firebase.auth().onAuthStateChanged(function (firebaseUser) {
          unsubscribe();
          // Check if we are already signed-in Firebase with the correct user.
          if (!isUserEqual(googleUser, firebaseUser)) {
            // Build Firebase credential with the Google ID token.
            var credential = firebase.auth.GoogleAuthProvider.credential(
              googleUser.getAuthResponse().id_token);
            // Sign in with credential from the Google user.
            firebase.auth().signInWithCredential(credential).catch(function (error) {
              // Handle Errors here.
              var errorCode = error.code;
              var errorMessage = error.message;
              // The email of the user's account used.
              var email = error.email;
              console.log(email)
              // The firebase.auth.AuthCredential type that was used.
              var credential = error.credential;
              // ...
            });
          } else {
            console.log('User already signed-in Firebase.');
          }
        });
      }

      function signOut() {
        var auth2 = gapi.auth2.getAuthInstance();
        auth2.signOut().then(function () {
          console.log('User signed out.');
        });
      }

      // // Client ID and API key from the Developer Console
      // var CLIENT_ID = '233306876297-4j117kamdlfm7v7rstb0sgndkbt56d1l.apps.googleusercontent.com';

      // // Array of API discovery doc URLs for APIs used by the quickstart
      // var DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/gmail/v1/rest"];

      // // Authorization scopes required by the API; multiple scopes can be
      // // included, separated by spaces.
      // var SCOPES = 'https://www.googleapis.com/auth/gmail.readonly';

      // var authorizeButton = document.getElementById('authorize-button');
      // var signoutButton = document.getElementById('signout-button');

      // /**
      //  *  On load, called to load the auth2 library and API client library.
      //  */
      // function handleClientLoad() {
      //   gapi.load('client:auth2', initClient);
      // }

      // /**
      //  *  Initializes the API client library and sets up sign-in state
      //  *  listeners.
      //  */
      // function initClient() {
      //   gapi.client.init({
      //     discoveryDocs: DISCOVERY_DOCS,
      //     clientId: CLIENT_ID,
      //     scope: SCOPES
      //   }).then(function () {
      //     // Listen for sign-in state changes.
      //     gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);

      //     // Handle the initial sign-in state.
      //     updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
      //     authorizeButton.onclick = handleAuthClick;
      //     signoutButton.onclick = handleSignoutClick;
      //   });
      // }

      // /**
      //  *  Called when the signed in status changes, to update the UI
      //  *  appropriately. After a sign-in, the API is called.
      //  */
      // function updateSigninStatus(isSignedIn) {
      //   if (isSignedIn) {
      //     authorizeButton.style.display = 'none';
      //     signoutButton.style.display = 'block';
      //     var socket = io.connect("http://localhost:8000", {reconnection:false});

      //     //TODO: SEND LOGIN MESSAGE TO SERVER HERE

      //     //listLabels();
      //   } else {
      //     authorizeButton.style.display = 'block';
      //     signoutButton.style.display = 'none';
      //   }
      // }

      // /**
      //  *  Sign in the user upon button click.
      //  */
      // function handleAuthClick(event) {
      //   gapi.auth2.getAuthInstance().signIn();
      // }

      // /**
      //  *  Sign out the user upon button click.
      //  */
      // function handleSignoutClick(event) {
      //   gapi.auth2.getAuthInstance().signOut();
      // }

      // /**
      //  * Append a pre element to the body containing the given message
      //  * as its text node. Used to display the results of the API call.
      //  *
      //  * @param {string} message Text to be placed in pre element.
      //  */
      // function appendPre(message) {
      //   var pre = document.getElementById('content');
      //   var textContent = document.createTextNode(message + '\n');
      //   pre.appendChild(textContent);
      // }

      // /**
      //  * Print all Labels in the authorized user's inbox. If no labels
      //  * are found an appropriate message is printed.
      //  */
      // function listLabels() {
      //   gapi.client.gmail.users.labels.list({
      //     'userId': 'me'
      //   }).then(function(response) {
      //     var labels = response.result.labels;
      //     appendPre('Labels:');

      //     if (labels && labels.length > 0) {
      //       for (i = 0; i < labels.length; i++) {
      //         var label = labels[i];
      //         appendPre(label.name)
      //       }
      //     } else {
      //       appendPre('No Labels found.');
      //     }
      //   });
      // }
  </script>

  <script async defer src="https://apis.google.com/js/api.js" onload="this.onload=function(){};handleClientLoad()" onreadystatechange="if (this.readyState === 'complete') this.onload()">

  </script>
</body>

</html>